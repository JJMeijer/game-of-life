"use strict";(()=>{var X="#cbd5e1",Z="#e2e8f0",Y="#64748b",T="start",S="stop",L="reset",A="canvas-hover",H="canvas-mousedown",z="mouseup",B="clear-canvas-hover",M="speed-change";var d=()=>{let e=document.getElementById("grid");if(!(e instanceof HTMLCanvasElement))throw new Error("Canvas element is Missing");return e};var G=()=>{let n=d().getContext("2d");if(!(n instanceof CanvasRenderingContext2D))throw new Error("Canvas context unexpectedly Missing");return n};var R=()=>{let e=document.getElementById("start");if(!(e instanceof HTMLButtonElement))throw new Error("Start Button unexpectedly missing");return e};var W=()=>{let e=document.getElementById("reset");if(!(e instanceof HTMLButtonElement))throw new Error("Reset Button unexpectedly missing");return e};var D=()=>{let e=document.getElementById("speed");if(!(e instanceof HTMLInputElement))throw new Error("Speed slider element unexpectedly missing");return e};var $=()=>{let e=d();e.width=window.innerWidth,e.height=window.innerHeight};var _=()=>{let e=document.getElementById("cellSize");if(!(e instanceof HTMLSelectElement))throw new Error("Cell Size element unexpectedly missing");return e};var q=class{constructor(){this.subscriberDictionary={}}subscribe(n,t){let o=this.subscriberDictionary[n]||[];o.push(t),this.subscriberDictionary[n]=o}publish(n,t){let o=this.subscriberDictionary[n];o&&o.forEach(l=>{l(t)})}},i=new q;var ee=()=>{let e=R();e.addEventListener("click",()=>{e.value==="start"?i.publish(T):i.publish(S)})},te=()=>{W().addEventListener("click",()=>{i.publish(L)})};var ne=()=>{d().addEventListener("mouseleave",()=>{i.publish(B)})},oe=()=>{let e=d();e.addEventListener("mousemove",({offsetX:n,offsetY:t})=>{t<=0||t>=e.height||n<=0||n>=e.width||i.publish(A,{offsetX:n,offsetY:t})})},re=()=>{let e=d();e.addEventListener("mousedown",({offsetX:n,offsetY:t})=>{t<0||t>e.height||n<0||n>e.width||i.publish(H,{offsetX:n,offsetY:t})})},se=()=>{document.addEventListener("mouseup",()=>{i.publish(z)})};var ie=()=>{_().addEventListener("change",()=>{i.publish(L)})};var le=()=>{let e=D();e.addEventListener("change",()=>{i.publish(M,{speed:parseInt(e.value)})})};var ce=()=>{oe(),ne(),re(),se(),ee(),te(),le(),ie()};var h=class{constructor(n,t,o,l,u,c,s){this.active=!1,this.x=t,this.y=o,this.w=l,this.h=u,this.row=c,this.col=s,this.ctx=n}hover(){this.ctx.fillStyle=this.active?Y:Z,this.ctx.fillRect(this.x,this.y,this.w,this.h)}clearHover(){this.active?this.activate():this.clear()}flip(){this.active?this.clear():this.activate()}activate(){this.ctx.fillStyle=X,this.ctx.fillRect(this.x,this.y,this.w,this.h),this.active=!0}clear(){this.ctx.clearRect(this.x,this.y,this.w,this.h),this.active=!1}};var N=(e,n)=>{let{size:t,xCells:o,yCells:l}=n,u={};for(let c=0;c<l;c++){let s={};for(let p=0;p<o;p++)s[p]=new h(e,p*t,c*t,t,t,c,p);u[c]=s}return console.log("Initialized Data: ",u),u};var O=(e,n,t)=>{let o=e[n];if(!o)return null;let l=o[t];return l||null};var ae=(e,n)=>{let t=e[n];if(!t)throw new Error("Row unexpectedly missing");return Object.values(t)},ue=(e,n)=>Object.values(e).map(o=>{let l=o[n];if(!l)throw new Error("Column unexpectedly missing");return l}),J=(e,n,t)=>{let o=n.sort((r,a)=>r-a)[0],l=ae(e,o);if(l.filter(r=>r.active).length){let r={};l.forEach(a=>{let{x:C,y:b,w:g,h:f,col:x,row:E,ctx:w}=a;r[`${x}`]=new h(w,C,b-f,g,f,E-1,x)}),e[o-1]=r}let u=t.sort((r,a)=>r-a)[0];ue(e,u).filter(r=>r.active).length&&Object.keys(e).forEach(r=>{let a=e[r],C=a[u],{x:b,y:g,w:f,h:x,col:E,ctx:w}=C;a[u-1]=new h(w,b-f,g,f,x,parseInt(r),E-1)});let s=n.sort((r,a)=>a-r)[0],p=ae(e,s);if(p.filter(r=>r.active).length){let r={};p.forEach(a=>{let{x:C,y:b,w:g,h:f,col:x,row:E,ctx:w}=a;r[`${x}`]=new h(w,C,b+f,g,f,E+1,x)}),e[s+1]=r}let F=t.sort((r,a)=>a-r)[0];ue(e,F).filter(r=>r.active).length&&Object.keys(e).forEach(r=>{let a=e[r],C=a[F],{x:b,y:g,w:f,h:x,col:E,ctx:w}=C;a[F+1]=new h(w,b+f,g,f,x,parseInt(r),E+1)})};var K=(e,n)=>{let{row:t,col:o}=n;return[[t-1,o-1],[t-1,o],[t-1,o+1],[t,o-1],[t,o+1],[t+1,o-1],[t+1,o],[t+1,o+1]].map(([c,s])=>O(e,c,s)).filter(c=>c!==null&&c.active).length};var V=()=>{let e=_(),n=parseInt(e.value),{width:t,height:o}=d();return{size:n,xCells:Math.ceil(t/n),yCells:Math.ceil(o/n)}};var y=(e,n,t)=>{let o=e/n;return Math.floor(t/o)};var m,v,I,k,Q=!1,j=[],P=0,U,me=()=>{$(),v=G(),I=V(),m=N(v,I),U=parseInt(D().value)},fe=()=>{let e=Object.keys(m).map(o=>parseInt(o)),n=Object.keys(m[0]).map(o=>parseInt(o));J(m,e,n);let t=[];e.forEach(o=>{let l=m[o];Object.keys(l).forEach(u=>{let c=l[u],s=K(m,c),{active:p}=c;p&&(s<2||s>3)&&t.push(c),!p&&s===3&&t.push(c)})}),console.log("---------------------"),console.log("Transitions: ",t.length),console.log("Grid Size: ",`${Object.keys(m[0]).length}x${Object.keys(m).length}`),t.forEach(o=>{o.flip()}),t.length===0&&(console.log("No Further Transitions"),i.publish(S))};i.subscribe(T,()=>{let e=()=>{P=setTimeout(e,U),fe()};P=setTimeout(e,U);let n=R();n.value="stop",n.innerText="Stop"});i.subscribe(S,()=>{clearTimeout(P),P=0;let e=R();e.value="start",e.innerText="Start"});i.subscribe(L,()=>{i.publish(S),Object.values(m).forEach(e=>{Object.values(e).forEach(n=>{n.active&&n.clear()})}),v.clearRect(0,0,v.canvas.width,v.canvas.height),I=V(),m=N(v,I)});i.subscribe(M,e=>{if(!e||!("speed"in e))throw new Error("Event data missing in Speed change Event");U=e.speed});i.subscribe(A,e=>{if(!e||!("offsetX"in e))throw new Error("Event data missing in Hover Event");let{offsetX:n,offsetY:t}=e,{xCells:o,yCells:l}=I,u=y(v.canvas.width,o,n),c=y(v.canvas.height,l,t),s=O(m,c,u);if(!!s){if(Q&&j.indexOf(s)===-1){s.flip(),j.push(s);return}s!==k&&(i.publish(B),s.hover(),k=s)}});i.subscribe(B,()=>{k&&k.clearHover()});i.subscribe(H,e=>{if(!e||!("offsetX"in e))throw new Error("Event data missing in Hover Event");Q=!0;let{offsetX:n,offsetY:t}=e,{xCells:o,yCells:l}=I,u=y(v.canvas.width,o,n),c=y(v.canvas.height,l,t),s=O(m,c,u);!s||(s.flip(),j.push(s))});i.subscribe(z,()=>{Q=!1,j=[]});var pe=()=>{me(),ce()};document.readyState!=="loading"?pe():document.addEventListener("DOMContentLoaded",()=>pe());})();
